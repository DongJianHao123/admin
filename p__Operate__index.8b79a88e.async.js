"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[991],{77949:function(X,F,e){e.r(F),e.d(F,{default:function(){return he}});var b=e(8601),m=e(64129),U=e.n(m),S=e(97983),l=e.n(S),M=e(40794),y=e.n(M),A=e(11281),j=e.n(A),G=e(12741),c=e.n(G),h=e(67294),w=e(34994),I=e(64317),g=e(5966),O=e(90672),T=e(85402),L=e(95239),u=e(12461),W=e(35295),C=e(62270),s=e(57778),f=e(19240),D=e(13714),_=e(4638),t=e(85893),p=T.Z.confirm,K=3e3,P=function(){var J,pe=L.Z.useForm(),ve=c()(pe,1),Z=ve[0],ge=(0,h.useState)([]),x=c()(ge,2),V=x[0],Te=x[1],Ee=(0,h.useState)(!1),q=c()(Ee,2),Se=q[0],Y=q[1],Ce=(0,h.useState)(!1),ee=c()(Ce,2),De=ee[0],k=ee[1],ye=(0,h.useState)(new Map),ne=c()(ye,2),te=ne[0],je=ne[1],Oe=(0,h.useState)({}),re=c()(Oe,2),R=re[0],H=re[1],Pe=(0,h.useState)(""),ae=c()(Pe,2),se=ae[0],Me=ae[1],Ae=(0,h.useState)(),ue=c()(Ae,2),E=ue[0],Ie=ue[1],Le=(0,h.useState)(!1),we=c()(Le,1),Be=we[0],Re=(0,h.useState)([]),ie=c()(Re,2),Fe=ie[0],$e=ie[1],be={labelCol:{span:6},wrapperCol:{span:14}},Ue=function(){var n=localStorage.getItem("client");if(!n)return{clientId:"1"};var a=JSON.parse(n);return a},We=function(){var n=Z.getFieldValue("phones");n&&(Y(n.length===V.length),k(n.length>0&&n.length<V.length))},le=function(){Y(!1),k(!1),Z.setFieldValue("phones",[]),H(j()(j()({},R),{},{phones:[]}))},oe=function(n,a){R[n]=a,H(j()({},R)),n==="template"&&(Ie(_.hY.find(function(o){return o.value===a})),console.log(E))},Ke=function(n){Z.setFieldValue("phones",n.target.checked?V:[]),oe("phones",n.target.checked?V:[]),k(!1),Y(n.target.checked)},de=function(){var r=y()(l()().mark(function n(a){var o,d,$;return l()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,(0,D.Zy)({size:K,courseId:a});case 2:if(v.t0=v.sent.data,v.t0){v.next=5;break}v.t0=[];case 5:o=v.t0,d=[],$=[],o.forEach(function(){var ze=y()(l()().mark(function me(ce){var N,fe;return l()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:N=ce.phone,fe=ce.name,d.findIndex(function(Je){return Je.includes(N)})<0&&(d.push([N,"".concat(fe,"<").concat(N,">")]),$.push(N));case 2:case"end":return Q.stop()}},me)}));return function(me){return ze.apply(this,arguments)}}()),le(),Te([].concat($)),je(new Map([].concat(d)));case 12:case"end":return v.stop()}},n)}));return function(a){return r.apply(this,arguments)}}(),Ze=function(){var r=y()(l()().mark(function n(a){var o,d;return l()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return d="\u300A".concat((o=Fe.find(function(v){return v.value===a}))===null||o===void 0?void 0:o.label,"\u300B"),Z.setFieldValue("title",d),R.title=d,H(j()({},R)),i.next=6,a==="1"?de():de(a.slice(-3));case 6:case"end":return i.stop()}},n)}));return function(a){return r.apply(this,arguments)}}(),Ne=function(){var r=y()(l()().mark(function n(a){var o,d;return l()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o={templateId:E.value,signature:se,data:E==null?void 0:E.params.map(function(v){return a[v]}),phones:a.phones},i.prev=1,i.next=4,(0,f.jO)(o);case 4:if(d=i.sent,d.errcode!==200){i.next=10;break}return u.ZP.success("\u53D1\u9001\u6210\u529F"),i.abrupt("return",!0);case 10:return u.ZP.error("\u53D1\u9001\u5931\u8D25,\u8BF7\u91CD\u8BD5"),i.abrupt("return",!1);case 12:i.next=19;break;case 14:return i.prev=14,i.t0=i.catch(1),u.ZP.error("\u53D1\u9001\u5931\u8D25"),console.log("\u53D1\u9001\u9519\u8BEF",i.t0),i.abrupt("return",!1);case 19:case"end":return i.stop()}},n,null,[[1,14]])}));return function(a){return r.apply(this,arguments)}}(),Ge=function(){var r=y()(l()().mark(function n(a){return l()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:p({title:"\u60A8\u786E\u5B9A\u8981\u53D1\u9001\u4FE1\u606F\u5417\uFF1F",onOk:function(){Ne(a),le()}});case 1:case"end":return d.stop()}},n)}));return function(a){return r.apply(this,arguments)}}();(0,h.useEffect)(function(){(0,f.o$)(Ue().clientId).then(function(r){Me(r)})},[]);var Ve=[se].concat(E==null?void 0:E.params.map(function(r){return R[r]}));return(0,t.jsxs)("div",{className:"sms-container",children:[(0,t.jsx)("div",{className:"preview",children:(0,t.jsx)(W.Z,{title:"\u9884\u89C8",children:(0,t.jsx)("p",{style:{width:"200px"},children:E?E.getContent(Ve):"\u8BF7\u9009\u62E9\u4E00\u4E2A\u77ED\u4FE1\u6A21\u677F"})})}),(0,t.jsxs)(w.A,j()(j()({className:"form",form:Z},be),{},{autoFocusFirstInput:!0,onFieldsChange:function(n){return oe(n[0].name[0],n[0].value)},onFinish:function(){var r=y()(l()().mark(function n(a){return l()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:Ge(a);case 1:case"end":return d.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),children:[(0,t.jsx)(I.Z,{request:y()(l()().mark(function r(){var n;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,s.tS)();case 2:return n=o.sent,$e(U()(n)),n.unshift({label:"\u5168\u90E8",value:"1"}),o.abrupt("return",n);case 6:case"end":return o.stop()}},r)})),fieldProps:{onChange:function(n){return Ze(n)}},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u9700\u8981\u53D1\u9001\u7684\u8BFE\u7A0B"}],width:"lg",name:"sendTo",label:"\u8BFE\u7A0B",placeholder:"\u8BF7\u9009\u62E9\u8BFE\u7A0B"}),(0,t.jsx)(I.Z,{request:y()(l()().mark(function r(){return l()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",_.hY);case 1:case"end":return a.stop()}},r)})),rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u77ED\u4FE1\u6A21\u677F"}],width:"lg",name:"template",label:"\u77ED\u4FE1\u6A21\u677F",placeholder:"\u8BF7\u9009\u62E9\u77ED\u4FE1\u6A21\u677F",allowClear:!0}),(0,t.jsx)(I.Z,{valueEnum:te,fieldProps:{mode:"multiple",onChange:We,maxTagCount:10,loading:Be},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u81F3\u5C11\u4E00\u540D\u5B66\u751F",type:"array"}],width:"lg",name:"phones",label:"\u8054\u7CFB\u4EBA",placeholder:"\u8BF7\u9009\u62E9\u8054\u7CFB\u4EBA",allowClear:!0,addonAfter:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.default,{onChange:Ke,indeterminate:De,checked:Se,children:"\u5168\u9009"}),(0,t.jsx)("span",{children:"".concat(((J=R.phones)===null||J===void 0?void 0:J.length)||0,"/").concat(te.size)})]})}),(0,t.jsx)(w.A.Group,{children:E==null?void 0:E.params.map(function(r,n){return r===_.A_.NAME?(0,t.jsx)(g.Z,{width:"lg",name:"call",label:"\u79F0\u547C",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u79F0\u547C"}]},n):r===_.A_.TITLE?(0,t.jsx)(g.Z,{width:"lg",name:"title",label:"\u6807\u9898",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}]},n):r===_.A_.DATE?(0,t.jsx)(g.Z,{width:"lg",name:"date",label:"\u65E5\u671F",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65F6\u95F4"}]},n):r===_.A_.ROLE?(0,t.jsx)(g.Z,{width:"lg",name:"role",label:"\u89D2\u8272",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272"}]},n):r===_.A_.NOTE?(0,t.jsx)(O.Z,{width:"lg",name:"note",label:"\u5907\u6CE8",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5907\u6CE8\u5185\u5BB9"}],fieldProps:{showCount:!0,maxLength:300,defaultValue:"\u4E0A\u8BFE\u94FE\u63A5\uFF1A"},placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},n):(0,t.jsx)(t.Fragment,{})})})]}))]})},B=P,z=function(){return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(b._z,{className:"operate-container",tabList:[{tab:"\u77ED\u4FE1\u901A\u77E5",key:"sms",children:(0,t.jsx)(B,{})}]})})},he=z},57778:function(X,F,e){e.d(F,{A5:function(){return g},ND:function(){return u},s4:function(){return T},tS:function(){return w}});var b=e(11281),m=e.n(b),U=e(97983),S=e.n(U),l=e(40794),M=e.n(l),y=e(63154),A=e(36275),j=e(30381),G=e.n(j),c=e(13714),h=e(14971);function w(){return I.apply(this,arguments)}function I(){return I=M()(S()().mark(function C(){return S()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",(0,c.wA)().then(function(D){var _=D.data;return console.log(_),_.map(function(t){return{label:t.title||" ",value:t.roomId||" "}}).filter(function(t,p,K){return K.findIndex(function(P){return P.value===t.value})===p})}));case 1:case"end":return f.stop()}},C)})),I.apply(this,arguments)}function g(C){return O.apply(this,arguments)}function O(){return O=M()(S()().mark(function C(s){var f,D,_;return S()().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return f=typeof s.startTime=="string"?s.startTime:s.startTime.$d,D=typeof s.endTime=="string"?s.endTime:s.endTime.$d,_=m()(m()({clientId:385},s),{},{startTime:new Date(f).getTime(),endTime:new Date(D).getTime()}),p.abrupt("return",(0,A.request)("/analysis/api/room-timesget/getClientTimeByClientId",{params:_}));case 4:case"end":return p.stop()}},C)})),O.apply(this,arguments)}function T(C){return L.apply(this,arguments)}function L(){return L=M()(S()().mark(function C(s){var f,D;return S()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f=typeof s.startTime=="string"?s.startTime:s.startTime.$d,D=typeof s.endTime=="string"?s.endTime:s.endTime.$d,t.abrupt("return",(0,A.request)("/analysis/api/room-timesget/getUserTimesWithTotalNumByConditions",{params:m()(m()({clientId:385},s),{},{sort:"startTime,desc",role:"student",startTime:new Date(f),endTime:new Date(D)})}).then(function(p){return{success:!0,total:p.totalNum,data:p.userTimeList}}));case 3:case"end":return t.stop()}},C)})),L.apply(this,arguments)}function u(C){return W.apply(this,arguments)}function W(){return W=M()(S()().mark(function C(s){var f,D;return S()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f=typeof s.startTime=="string"?s.startTime:s.startTime.$d,D=typeof s.endTime=="string"?s.endTime:s.endTime.$d,t.abrupt("return",(0,A.request)("/analysis/api/studentRoomTimeDetailStatistics",{params:m()(m()({clientId:385},s),{},{startTime:h.Z.date.format(new Date(f),"yyyy-MM-dd"),endTime:h.Z.date.format(new Date(D),"yyyy-MM-dd")})}).then(function(p){var K=p.dayDetail.map(function(P){return m()(m()({},P),{},{times:P.info.length,duration:P.info.map(function(B){return B.timeLong}).reduce(function(B,z){return B+z},0)},Object.fromEntries(P.info.map(function(B){return[B.sumDay,B.timeLong]})))}).filter(function(P){return P.duration});return m()(m()({},p),{},{data:K,success:!0})}));case 3:case"end":return t.stop()}},C)})),W.apply(this,arguments)}},19240:function(X,F,e){e.d(F,{jO:function(){return G},o$:function(){return h},rz:function(){return I}});var b=e(97983),m=e.n(b),U=e(11281),S=e.n(U),l=e(40794),M=e.n(l),y=e(9669),A=e.n(y),j="http://101.201.249.16:4000";function G(g){return c.apply(this,arguments)}function c(){return c=M()(m()().mark(function g(O){var T;return m()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,A()(j+"/api/v1/msms/inform",{method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(S()({},O))});case 2:return T=u.sent,console.log("\u8BF7\u6C42\u7ED3\u679C",T),u.abrupt("return",T.data);case 5:case"end":return u.stop()}},g)})),c.apply(this,arguments)}function h(g){return w.apply(this,arguments)}function w(){return w=M()(m()().mark(function g(O){var T;return m()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,A().get(j+"/api/v1/msms/get_signature/?clientId=".concat(O));case 2:if(T=u.sent,T.data.errcode!==200){u.next=7;break}return u.abrupt("return",T.data.data);case 7:return u.abrupt("return","");case 8:case"end":return u.stop()}},g)})),w.apply(this,arguments)}var I=function(O,T,L){A()({method:"post",url:"https://api.os2edu.cn/api/chat-process",data:{prompt:O,options:{parentMessageId:T},systemMessage:"\u4F60\u73B0\u5728\u662F\u4E00\u4E2A\u6559\u80B2\u5DE5\u4F5C\u8005\uFF0C\u4F60\u9700\u8981\u8F85\u52A9\u6211\u7BA1\u7406\u597D\u4E00\u4E2A\u6559\u80B2\u673A\u6784\u7684\u540E\u53F0\uFF0C\u7B80\u5316\u6211\u4EEC\u7684\u5DE5\u4F5C",temperature:.8,top_p:1},onDownloadProgress:L}).then(function(){})}}}]);
