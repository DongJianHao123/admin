"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[991],{77949:function(x,$,e){e.r($),e.d($,{default:function(){return pe}});var U=e(95855),m=e(64129),w=e.n(m),D=e(97983),l=e.n(D),M=e(40794),C=e.n(M),A=e(11281),y=e.n(A),G=e(12741),c=e.n(G),p=e(67294),B=e(10703),I=e(25641),g=e(47745),O=e(99644),T=e(85402),L=e(95239),u=e(12461),W=e(35295),S=e(62270),s=e(57778),f=e(19240),j=e(13714),h=e(4638),n=e(85893),v=T.Z.confirm,K=3e3,P=function(){var J,ve=L.Z.useForm(),_e=c()(ve,1),Z=_e[0],ge=(0,p.useState)([]),k=c()(ge,2),V=k[0],Te=k[1],Ee=(0,p.useState)(!1),q=c()(Ee,2),De=q[0],Y=q[1],Se=(0,p.useState)(!1),ee=c()(Se,2),je=ee[0],H=ee[1],Ce=(0,p.useState)(new Map),te=c()(Ce,2),ne=te[0],ye=te[1],Oe=(0,p.useState)({}),re=c()(Oe,2),F=re[0],Q=re[1],Pe=(0,p.useState)(""),ae=c()(Pe,2),se=ae[0],Me=ae[1],Ae=(0,p.useState)(),ue=c()(Ae,2),E=ue[0],Ie=ue[1],Le=(0,p.useState)(!1),Be=c()(Le,1),Re=Be[0],Fe=(0,p.useState)([]),ie=c()(Fe,2),$e=ie[0],be=ie[1],Ue={labelCol:{span:6},wrapperCol:{span:14}},we=function(){var t=localStorage.getItem("client");if(!t)return{clientId:"1"};var a=JSON.parse(t);return a},We=function(){var t=Z.getFieldValue("phones");t&&(Y(t.length===V.length),H(t.length>0&&t.length<V.length))},le=function(){Y(!1),H(!1),Z.setFieldValue("phones",[]),Q(y()(y()({},F),{},{phones:[]}))},oe=function(t,a){F[t]=a,Q(y()({},F)),t==="template"&&(Ie(h.hY.find(function(o){return o.value===a})),console.log(E))},Ke=function(t){Z.setFieldValue("phones",t.target.checked?V:[]),oe("phones",t.target.checked?V:[]),H(!1),Y(t.target.checked)},de=function(){var r=C()(l()().mark(function t(a){var o,d,b;return l()().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,(0,j.Zy)({size:K,courseId:a});case 2:if(_.t0=_.sent.data,_.t0){_.next=5;break}_.t0=[];case 5:o=_.t0,d=[],b=[],o.forEach(function(){var ze=C()(l()().mark(function me(ce){var N,fe;return l()().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:N=ce.phone,fe=ce.name,d.findIndex(function(Je){return Je.includes(N)})<0&&(d.push([N,"".concat(fe,"<").concat(N,">")]),b.push(N));case 2:case"end":return X.stop()}},me)}));return function(me){return ze.apply(this,arguments)}}()),le(),Te([].concat(b)),ye(new Map([].concat(d)));case 12:case"end":return _.stop()}},t)}));return function(a){return r.apply(this,arguments)}}(),Ze=function(){var r=C()(l()().mark(function t(a){var o,d;return l()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return d="\u300A".concat((o=$e.find(function(_){return _.value===a}))===null||o===void 0?void 0:o.label,"\u300B"),Z.setFieldValue("title",d),F.title=d,Q(y()({},F)),i.next=6,a==="1"?de():de(a.slice(-3));case 6:case"end":return i.stop()}},t)}));return function(a){return r.apply(this,arguments)}}(),Ne=function(){var r=C()(l()().mark(function t(a){var o,d;return l()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o={templateId:E.value,signature:se,data:E==null?void 0:E.params.map(function(_){return a[_]}),phones:a.phones},i.prev=1,i.next=4,(0,f.jO)(o);case 4:if(d=i.sent,d.errcode!==200){i.next=10;break}return u.ZP.success("\u53D1\u9001\u6210\u529F"),i.abrupt("return",!0);case 10:return u.ZP.error("\u53D1\u9001\u5931\u8D25,\u8BF7\u91CD\u8BD5"),i.abrupt("return",!1);case 12:i.next=19;break;case 14:return i.prev=14,i.t0=i.catch(1),u.ZP.error("\u53D1\u9001\u5931\u8D25"),console.log("\u53D1\u9001\u9519\u8BEF",i.t0),i.abrupt("return",!1);case 19:case"end":return i.stop()}},t,null,[[1,14]])}));return function(a){return r.apply(this,arguments)}}(),Ge=function(){var r=C()(l()().mark(function t(a){return l()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:v({title:"\u60A8\u786E\u5B9A\u8981\u53D1\u9001\u4FE1\u606F\u5417\uFF1F",onOk:function(){Ne(a),le()}});case 1:case"end":return d.stop()}},t)}));return function(a){return r.apply(this,arguments)}}();(0,p.useEffect)(function(){(0,f.o$)(we().clientId).then(function(r){Me(r)})},[]);var Ve=[se].concat(E==null?void 0:E.params.map(function(r){return F[r]}));return(0,n.jsxs)("div",{className:"sms-container",children:[(0,n.jsx)("div",{className:"preview",children:(0,n.jsx)(W.Z,{title:"\u9884\u89C8",children:(0,n.jsx)("p",{style:{width:"200px"},children:E?E.getContent(Ve):"\u8BF7\u9009\u62E9\u4E00\u4E2A\u77ED\u4FE1\u6A21\u677F"})})}),(0,n.jsxs)(B.A,y()(y()({className:"form",form:Z},Ue),{},{autoFocusFirstInput:!0,onFieldsChange:function(t){return oe(t[0].name[0],t[0].value)},onFinish:function(){var r=C()(l()().mark(function t(a){return l()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:Ge(a);case 1:case"end":return d.stop()}},t)}));return function(t){return r.apply(this,arguments)}}(),children:[(0,n.jsx)(I.Z,{request:C()(l()().mark(function r(){var t;return l()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,(0,s.tS)();case 2:return t=o.sent,be(w()(t)),t.unshift({label:"\u5168\u90E8",value:"1"}),o.abrupt("return",t);case 6:case"end":return o.stop()}},r)})),fieldProps:{onChange:function(t){return Ze(t)}},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u9700\u8981\u53D1\u9001\u7684\u8BFE\u7A0B"}],width:"lg",name:"sendTo",label:"\u8BFE\u7A0B",placeholder:"\u8BF7\u9009\u62E9\u8BFE\u7A0B"}),(0,n.jsx)(I.Z,{request:C()(l()().mark(function r(){return l()().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",h.hY);case 1:case"end":return a.stop()}},r)})),rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E00\u4E2A\u77ED\u4FE1\u6A21\u677F"}],width:"lg",name:"template",label:"\u77ED\u4FE1\u6A21\u677F",placeholder:"\u8BF7\u9009\u62E9\u77ED\u4FE1\u6A21\u677F",allowClear:!0}),(0,n.jsx)(I.Z,{valueEnum:ne,fieldProps:{mode:"multiple",onChange:We,maxTagCount:10,loading:Re},rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u81F3\u5C11\u4E00\u540D\u5B66\u751F",type:"array"}],width:"lg",name:"phones",label:"\u8054\u7CFB\u4EBA",placeholder:"\u8BF7\u9009\u62E9\u8054\u7CFB\u4EBA",allowClear:!0,addonAfter:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.default,{onChange:Ke,indeterminate:je,checked:De,children:"\u5168\u9009"}),(0,n.jsx)("span",{children:"".concat(((J=F.phones)===null||J===void 0?void 0:J.length)||0,"/").concat(ne.size)})]})}),(0,n.jsx)(B.A.Group,{children:E==null?void 0:E.params.map(function(r,t){return r===h.A_.NAME?(0,n.jsx)(g.Z,{width:"lg",name:"call",label:"\u79F0\u547C",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u79F0\u547C"}]},t):r===h.A_.TITLE?(0,n.jsx)(g.Z,{width:"lg",name:"title",label:"\u6807\u9898",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898"}]},t):r===h.A_.DATE?(0,n.jsx)(g.Z,{width:"lg",name:"date",label:"\u65E5\u671F",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u65F6\u95F4"}]},t):r===h.A_.ROLE?(0,n.jsx)(g.Z,{width:"lg",name:"role",label:"\u89D2\u8272",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272"}]},t):r===h.A_.NOTE?(0,n.jsx)(O.Z,{width:"lg",name:"note",label:"\u5907\u6CE8",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5907\u6CE8\u5185\u5BB9"}],fieldProps:{showCount:!0,maxLength:300,defaultValue:"\u4E0A\u8BFE\u94FE\u63A5\uFF1A"},placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},t):(0,n.jsx)(n.Fragment,{})})})]}))]})},R=P,z=function(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(U._z,{className:"operate-container",tabList:[{tab:"\u77ED\u4FE1\u901A\u77E5",key:"sms",children:(0,n.jsx)(R,{})}]})})},pe=z},57778:function(x,$,e){e.d($,{A5:function(){return g},ND:function(){return u},s4:function(){return T},tS:function(){return B}});var U=e(11281),m=e.n(U),w=e(97983),D=e.n(w),l=e(40794),M=e.n(l),C=e(63154),A=e(36275),y=e(30381),G=e.n(y),c=e(13714),p=e(14971);function B(){return I.apply(this,arguments)}function I(){return I=M()(D()().mark(function S(){return D()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",(0,c.wA)().then(function(j){var h=j.data;return console.log(h),h.map(function(n){return{label:n.title||" ",value:n.roomId||" "}}).filter(function(n,v,K){return K.findIndex(function(P){return P.value===n.value})===v})}));case 1:case"end":return f.stop()}},S)})),I.apply(this,arguments)}function g(S){return O.apply(this,arguments)}function O(){return O=M()(D()().mark(function S(s){var f,j,h;return D()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return f=typeof s.startTime=="string"?s.startTime:s.startTime.$d,j=typeof s.endTime=="string"?s.endTime:s.endTime.$d,h=m()(m()({clientId:385},s),{},{startTime:new Date(f).getTime(),endTime:new Date(j).getTime()}),v.abrupt("return",(0,A.request)("/analysis/api/room-timesget/getClientTimeByClientId",{params:h}));case 4:case"end":return v.stop()}},S)})),O.apply(this,arguments)}function T(S){return L.apply(this,arguments)}function L(){return L=M()(D()().mark(function S(s){var f,j;return D()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return f=typeof s.startTime=="string"?s.startTime:s.startTime.$d,j=typeof s.endTime=="string"?s.endTime:s.endTime.$d,n.abrupt("return",(0,A.request)("/analysis/api/room-timesget/getUserTimesWithTotalNumByConditions",{params:m()(m()({clientId:385},s),{},{sort:"startTime,desc",role:"student",startTime:new Date(f),endTime:new Date(j)})}).then(function(v){return{success:!0,total:v.totalNum,data:v.userTimeList}}));case 3:case"end":return n.stop()}},S)})),L.apply(this,arguments)}function u(S){return W.apply(this,arguments)}function W(){return W=M()(D()().mark(function S(s){var f,j;return D()().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return f=typeof s.startTime=="string"?s.startTime:s.startTime.$d,j=typeof s.endTime=="string"?s.endTime:s.endTime.$d,n.abrupt("return",(0,A.request)("/analysis/api/studentRoomTimeDetailStatistics",{params:m()(m()({clientId:385},s),{},{startTime:p.Z.date.format(new Date(f),"yyyy-MM-dd"),endTime:p.Z.date.format(new Date(j),"yyyy-MM-dd")})}).then(function(v){var K=v.dayDetail.map(function(P){return m()(m()({},P),{},{times:P.info.length,duration:P.info.map(function(R){return R.timeLong}).reduce(function(R,z){return R+z},0)},Object.fromEntries(P.info.map(function(R){return[R.sumDay,R.timeLong]})))}).filter(function(P){return P.duration});return m()(m()({},v),{},{data:K,success:!0})}));case 3:case"end":return n.stop()}},S)})),W.apply(this,arguments)}},19240:function(x,$,e){e.d($,{jO:function(){return G},o$:function(){return p},rz:function(){return I}});var U=e(97983),m=e.n(U),w=e(11281),D=e.n(w),l=e(40794),M=e.n(l),C=e(9669),A=e.n(C),y="http://101.201.249.16:4000";function G(g){return c.apply(this,arguments)}function c(){return c=M()(m()().mark(function g(O){var T;return m()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,A()(y+"/api/v1/msms/inform",{method:"post",headers:{"Content-Type":"application/json"},data:JSON.stringify(D()({},O))});case 2:return T=u.sent,console.log("\u8BF7\u6C42\u7ED3\u679C",T),u.abrupt("return",T.data);case 5:case"end":return u.stop()}},g)})),c.apply(this,arguments)}function p(g){return B.apply(this,arguments)}function B(){return B=M()(m()().mark(function g(O){var T;return m()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,A().get(y+"/api/v1/msms/get_signature/?clientId=".concat(O));case 2:if(T=u.sent,T.data.errcode!==200){u.next=7;break}return u.abrupt("return",T.data.data);case 7:return u.abrupt("return","");case 8:case"end":return u.stop()}},g)})),B.apply(this,arguments)}var I=function(O,T,L){A()({method:"post",url:"https://api.os2edu.cn/api/chat-process",data:{prompt:O,options:{parentMessageId:T},systemMessage:"\u4F60\u73B0\u5728\u662F\u4E00\u4E2A\u6559\u80B2\u5DE5\u4F5C\u8005\uFF0C\u4F60\u9700\u8981\u8F85\u52A9\u6211\u7BA1\u7406\u597D\u4E00\u4E2A\u6559\u80B2\u673A\u6784\u7684\u540E\u53F0\uFF0C\u7B80\u5316\u6211\u4EEC\u7684\u5DE5\u4F5C",temperature:.8,top_p:1},onDownloadProgress:L}).then(function(){})}}}]);
